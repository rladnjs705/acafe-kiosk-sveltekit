import{m as A,w as a}from"./singletons-3b1b6c95.js";import{a as f}from"./axios-bff3f665.js";const S=!0,C=S,y=0,L="ADMIN",H="USER",T="add_mode",M="edit_mode";function N(){const{subscribe:e,set:t}=a(!1);return{subscribe:e,set:t,openModal:()=>t(!0),closeModal:()=>t(!1)}}function w(){const e={itemId:"",itemName:"",categoryId:"",itemPrice:0,itemImage:"http://localhost:3000/images/noImage.jpg"},{subscribe:t,set:o}=a({...e});return{subscribe:t,set:o,resetForm:()=>o({...e})}}function E(){const e={pageNumber:0},{subscribe:t,set:o,update:c}=a({...e});return{subscribe:t,nextPage:()=>{c(m=>(m.pageNumber=m.pageNumber+1,k.set(!0),B.set(!0),m))},resetPage:()=>{k.set(!0),o({...e})}}}function v(){const{subscribe:e,set:t}=a("");return{subscribe:e,onAddMode:()=>t(T),onEditMode:()=>t(M)}}function V(){const{subscribe:e,set:t}=a(y);return{subscribe:e,selectCategory:c=>{t(c),q.resetPage(),P.set(!0)}}}function O(){const e="",t=window.localStorage.getItem("token")??e,{subscribe:o,update:c,set:u}=a(t);return{subscribe:o,saveAuthToken:s=>{try{return localStorage.setItem("token",s.token),u(s.token),!0}catch(r){console.log(r)}},removeAuthToken:()=>u(""),checkToken:()=>{const s="";(window.localStorage.getItem("token")??s)||u("")}}}function _(){let e={_id:"",email:"",role:"",nickName:"",userName:""},t={params:{authToken:""}};const{subscribe:o,set:c}=a({...e});return{subscribe:o,createAuth:async()=>{try{const m="",n=C?window.localStorage.getItem("token")??m:m;t.params.authToken=n;const r=(await f.get("/api/user/login/info",t)).data.data.user,d=r.id,g=r.email,i=r.role,p=r.nickName,b=r.userName;c({_id:d,email:g,role:i,nickName:p,userName:b});return}catch{h.removeAuthToken(),c({...e});return}},resetAuth:()=>{h.removeAuthToken(),c({...e})}}}function D(){return A(z,t=>t.role===L)}function F(){const e={userId:0,orderPriceSum:0,orderCount:0,orderItems:[]},{subscribe:t,update:o,set:c}=a({...e});return{subscribe:t,resetOrder:()=>c({...e}),incrementOrder:(n,s)=>{o(r=>{let d=r.orderPriceSum,g=r.orderCount,i=r.orderItems,p=s._id;if(i.find(l=>l.itemId===n.itemId))i=i.map(l=>(l.itemId===n.itemId&&(l.itemPriceSum=l.itemPriceSum+n.itemPrice,l.itemCount=l.itemCount+1),l));else{const l={userId:s._id,itemId:n.itemId,itemName:n.itemName,itemPrice:n.itemPrice,itemPriceSum:n.itemPrice,itemCount:1};i=[...i,l]}return d=d+n.itemPrice,g=g+1,r.orderPriceSum=d,r.orderCount=g,r.orderItems=i,r.userId=p,r})},decrementOrder:n=>{o(s=>{let r=s.orderPriceSum,d=s.orderCount,g=s.orderItems;return g=g.map(i=>(i.itemId===n.itemId&&(i.itemPriceSum=i.itemPriceSum-n.itemPrice,i.itemCount=i.itemCount-1),i)).filter(i=>i.itemCount!==0),console.log(d),r=r-n.itemPrice,d=d-1,s.orderPriceSum=r,s.orderCount=d,s.orderItems=g,s})}}}function R(){const{subscribe:e,update:t,set:o}=a();return{subscribe:e,getCategoryList:async()=>{try{const u=await f.get("/api/user/categories");o(u.data.data)}catch(u){console.log(u)}},update:t}}function x(){let e={page:0,size:15,itemName:"",categoryId:0};const{subscribe:t,update:o,set:c}=a();return{subscribe:t,getItemList:async(I,m,n)=>{try{m!=""&&m!=null?e.itemName=m:e.itemName="",I>0?(k.set(!0),e.page=I):e.page=0,n>0&&n!=null?e.categoryId=n:e.categoryId=0;const s=await f.get("/api/user/items",{params:e});c(s.data.data),P.set(!1)}catch(s){console.log(s)}},update:o}}function U(){const{subscribe:e,update:t,set:o}=a();return{subscribe:e,update:t,set:o,getOrderList:async()=>{try{const u=await f.get("/api/admin/orders/subscribe");o(u.data)}catch(u){console.log(u)}}}}function j(){const{subscribe:e,update:t,set:o}=a();return{update:t,resetErrors:()=>o(),subscribe:e,set:o}}const J=a(!1),K=N(),Q=w(),q=E(),k=a(!1),X=v(),Y=V(),Z=a(""),h=O(),z=_(),$=D(),ee=F(),te=j(),P=a(!1),B=a(!1),oe=R(),re=x(),se=U();export{y as A,M as E,H as U,h as a,Y as b,oe as c,$ as d,re as e,k as f,Z as g,q as h,P as i,z as j,Q as k,ee as l,J as m,X as n,te as o,K as p,T as q,se as r,L as s};
